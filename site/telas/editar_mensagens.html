<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="stylesheet" href="/site/assets/estilos/forum.css">
    </head>
<body>
    <main>
        <h1>Editar Mensagem</h1>
        <form id="editForm">
            <input type="hidden" id="messageId">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" readonly><br><br>
            <label for="mensagem">Mensagem:</label>
            <textarea id="mensagem" name="mensagem"></textarea><br><br>
            <label for="data">Data:</label>
            <input type="text" id="data" name="data" readonly><br><br>
            <button type="submit">Salvar</button>
        </form>
    </main>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const messageId = urlParams.get('id');

        async function loadMessage() {
            try {
                const response = await fetch(`http://localhost:3000/mensagens/${messageId}`);
                const message = await response.json();

                document.getElementById('messageId').value = message.id;
                document.getElementById('nome').value = message.nome;
                document.getElementById('mensagem').value = message.mensagem;
                document.getElementById('data').value = message.data;
            } catch (error) {
                console.error('Erro ao carregar mensagem:', error.message);
            }
        }

        async function editMessage() {
            const messageId = document.getElementById('messageId').value;
            const mensagem = document.getElementById('mensagem').value;

            try {
                const response = await fetch(`http://localhost:3000/mensagens/${messageId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ mensagem })
                });

                if (!response.ok) {
                    throw new Error('Erro ao editar mensagem.');
                }

                alert('Mensagem editada com sucesso!');
                window.location.href = 'mensagens.html';
            } catch (error) {
                console.error('Erro ao editar mensagem:', error.message);
            }
        }

        window.onload = loadMessage;
        document.getElementById('editForm').addEventListener('submit', (event) => {
            event.preventDefault();
            editMessage();
        });
    </script>
</body>
</html>
